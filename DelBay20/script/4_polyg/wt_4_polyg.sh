#!/bin/bash
for i in {1..19}
do
    echo -e '#!/bin/bash\nstart=`date +%s`  ## date at start\n## This script is used to quality filter and trim poly g tails. It can process both paired end and single end data.\nBASEDIR=/workdir/hz269/DelBay20\nSAMPLELIST=$BASEDIR/sample_lists/fastq_list_'$i'.txt # Path to a list of prefixes of the raw fastq files. It should be a subset of the the 1st column of the sample table. \nSAMPLETABLE=$BASEDIR/sample_lists/fastq_table.txt # Path to a sample table where the 1st column is the prefix of the raw fastq files. The 4th column is the sample ID, the 2nd column is the lane number, and the 3rd column is sequence ID. The combination of these three columns have to be unique. The 6th column should be data type, which is either pe or se.\nFILTER=polyg # Type of filtering. Values can be: polyg (forced PolyG trimming only), quality (quality trimming, PolyG will be trimmed as well if processing NextSeq/NovaSeq data), or length (trim all reads to a maximum length)\nTHREAD=1 # Number of thread to use. Default is 10\nFASTP=/programs/fastp-0.20.0/bin/fastp ## Path to the fastp program. The default path is /workdir/programs/fastp_0.19.7/fastp\nMAXLENGTH=100 # Maximum length. This input is only relevant when FILTER=length, and its default value is 100.\n\n## Loop over each sample\nfor SAMPLEFILE in `cat $SAMPLELIST`; do\n\n\t## Extract relevant values from a table of sample, sequencing, and lane ID (here in columns 4, 3, 2, respectively) for each sequenced library\n\tSAMPLE_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 4`\n\tPOP_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 5`\n\tSEQ_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 3`\n\tLANE_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 2`\n\tSAMPLE_UNIQ_ID=$SAMPLE_ID'\''_'\''$POP_ID'\''_'\''$SEQ_ID'\''_'\''$LANE_ID\n\techo "Sample: $SAMPLE_UNIQ_ID"\n\t## Extract data type from the sample table\n\tDATATYPE=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 6`\n\t## The input and output path and file prefix\n\tSAMPLEADAPT=$BASEDIR'\''/adapter_clipped/'\''$SAMPLE_UNIQ_ID\n\tSAMPLEQUAL=$BASEDIR'\''/qual_filtered/'\''$SAMPLE_UNIQ_ID\n\n\t## Trim polyg tail or low quality tail with fastp.\n\t# --trim_poly_g forces polyg trimming, --cut_right enables cut_right quality trimming\n\t# -Q disables quality filter, -L disables length filter, -A disables adapter trimming\n\t# Go to https://github.com/OpenGene/fastp for more information\n\tif [ $DATATYPE = pe ]; then\n\t\tif [ $FILTER = polyg ]; then\n\t\t\t$FASTP --trim_poly_g --cut_right -L -A --thread $THREAD -i $SAMPLEADAPT'\''_adapter_clipped_f_paired.fastq.gz'\'' -I $SAMPLEADAPT'\''_adapter_clipped_r_paired.fastq.gz'\'' -o $SAMPLEQUAL'\''_adapter_clipped_qual_filtered_f_paired.fastq.gz'\'' -O $SAMPLEQUAL'\''_adapter_clipped_qual_filtered_r_paired.fastq.gz'\'' -h $SAMPLEQUAL'\''_adapter_clipped_fastp.html'\'' -j $SAMPLEQUAL'\''_adapter_clipped_fastp.json'\''\n\t\telif [ $FILTER = quality ]; then\n\t\t\t$FASTP -L -A --thread $THREAD -i $SAMPLEADAPT'\''_adapter_clipped_f_paired.fastq.gz'\'' -I $SAMPLEADAPT'\''_adapter_clipped_r_paired.fastq.gz'\'' -o $SAMPLEQUAL'\''_adapter_clipped_qual_filtered_f_paired.fastq.gz'\'' -O $SAMPLEQUAL'\''_adapter_clipped_qual_filtered_r_paired.fastq.gz'\'' -h $SAMPLEQUAL'\''_adapter_clipped_fastp.html'\'' -j $SAMPLEQUAL'\''_adapter_clipped_fastp.json'\''\n\t\telif [ $FILTER = length ]; then\n\t\t\t$FASTP --max_len1 $MAXLENGTH -Q -L -A --thread $THREAD -i $SAMPLEADAPT'\''_adapter_clipped_f_paired.fastq.gz'\'' -I $SAMPLEADAPT'\''_adapter_clipped_r_paired.fastq.gz'\'' -o $SAMPLEQUAL'\''_adapter_clipped_qual_filtered_f_paired.fastq.gz'\'' -O $SAMPLEQUAL'\''_adapter_clipped_qual_filtered_r_paired.fastq.gz'\'' -h $SAMPLEQUAL'\''_adapter_clipped_fastp.html'\'' -j $SAMPLEQUAL'\''_adapter_clipped_fastp.json'\''\n\t\tfi\n\tfi\ndone\n\nend=`date +%s` ## date at end\nruntime=$((end-start))\nhours=$((runtime / 3600))\nminutes=$(( (runtime % 3600) / 60 ))\nseconds=$(( (runtime % 3600) % 60 ))\necho "Runtime: $hours:$minutes:$seconds (hh:mm:ss)"' >> formal/'4_polyg_'$i'.sh'
done

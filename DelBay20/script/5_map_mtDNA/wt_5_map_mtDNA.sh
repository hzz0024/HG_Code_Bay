for i in {1..19}
do
    echo -e 'start=`date +%s` \nBASEDIR=/workdir/hz269/DelBay20\nBOWTIE=/programs/bowtie2-2.3.5.1-linux-x86_64/bowtie2\nSAMTOOLS=/programs/samtools-1.11/bin/samtools\nSAMPLELIST=$BASEDIR/sample_lists/fastq_list_'$i'.txt # Path to a list of prefixes of the raw fastq files. It should be a subset of the the 1st column of the sample table.\nSAMPLETABLE=$BASEDIR/sample_lists/fastq_table.txt # Path to a sample table where the 1st column is the prefix of the raw fastq files. The 4th column is the sample ID, the 2nd column is the lane number, and the 3rd column is sequence ID. The combination of these three columns have to be unique. The 6th column should be data type, which is either pe or se.\nFASTQDIR=$BASEDIR/qual_filtered/ # Path to the directory where fastq file are stored.\nFASTQSUFFIX1=_adapter_clipped_qual_filtered_f_paired.fastq.gz # Suffix to fastq files. Use forward reads with paired-end data.\nFASTQSUFFIX2=_adapter_clipped_qual_filtered_r_paired.fastq.gz # Suffix to fastq files. Use reverse reads with paired-end data.\nMAPPINGPRESET=very-sensitive # The pre-set option to use for mapping in bowtie2 (very-sensitive for end-to-end (global) mapping [typically used when we have a full genome reference], very-sensitive-local for partial read mapping that allows soft-clipping [typically used when mapping genomic reads to a transcriptome]\nREFERENCE=$BASEDIR/reference/CV30_mtDNA.fasta # Path to reference fasta file and file name\nREFNAME=CV30_mtDNA # Reference name to add to output files, e.g. gadMor2\n\n## Loop over each sample\nfor SAMPLEFILE in `cat $SAMPLELIST`; do\n\n\t## Extract relevant values from a table of sample, sequencing, and lane ID (here in columns 4, 3, 2, respectively) for each sequenced library\n\tSAMPLE_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 4`\n\tPOP_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 5`\n\tSEQ_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 3`\n\tLANE_ID=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 2`\n\tSAMPLE_UNIQ_ID=$SAMPLE_ID'\''_'\''$POP_ID'\''_'\''$SEQ_ID'\''_'\''$LANE_ID  # When a sample has been sequenced in multiple lanes, we need to be able to identify the files from each run uniquely\n\n\t## Extract data type from the sample table\n\tDATATYPE=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 6`\n\n\t## The input and output path and file prefix\n\tSAMPLETOMAP=$FASTQDIR$SAMPLE_UNIQ_ID\n\tSAMPLEBAM=$BASEDIR'\''/bam_mtDNA/'\''$SAMPLE_UNIQ_ID\n\tSAMPLETOFASTQ=$BASEDIR'\''/mt_mapped/'\''$SAMPLE_UNIQ_ID\n\n\t## Define platform unit (PU), which is the lane number\n\tPU=`grep -P "${SAMPLEFILE}\\t" $SAMPLETABLE | cut -f 2`\n\n\t## Define reference base name\n\tREFBASENAME="${REFERENCE%.*}"\n\n\t## Map reads to the reference\n\techo $SAMPLE_UNIQ_ID\n\n\t# Map the mtDNA\n\t$BOWTIE -q --phred33 --$MAPPINGPRESET --un-conc-gz $SAMPLETOFASTQ -p 1 -I 0 -X 1500 --fr --rg-id $SAMPLE_UNIQ_ID --rg SM:$SAMPLE_ID --rg LB:$SAMPLE_ID --rg PU:$PU --rg PL:ILLUMINA -x $REFBASENAME -1 $SAMPLETOMAP$FASTQSUFFIX1 -2 $SAMPLETOMAP$FASTQSUFFIX2 -S $SAMPLEBAM'\''_'\''$DATATYPE'\''_bt2_'\''$REFNAME'\''.sam'\''\n\n\t# Remove the sam files\n\trm -f $SAMPLEBAM'\''_'\''$DATATYPE'\''_bt2_'\''$REFNAME'\''.sam'\''\ndone\n\nend=`date +%s` ## date at end\nruntime=$((end-start))\nhours=$((runtime / 3600))\nminutes=$(( (runtime % 3600) / 60 ))\nseconds=$(( (runtime % 3600) % 60 ))\necho "Runtime: $hours:$minutes:$seconds (hh:mm:ss)"' >> formal/'5_map_mtDNA_'$i'.sh'
done
